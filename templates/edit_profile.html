{% extends "base.html" %}

{% block title %}Edit Profile{% endblock %}

{% block content %}
<div class="profile-edit-page">
  <div class="container">
    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert alert-{{ category }} mb-4">
            {{ message }}
            <button type="button" class="close" onclick="this.parentElement.remove()">
              <span>&times;</span>
            </button>
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <!-- Profile Header -->
    <div class="profile-header mb-5">
      <div class="avatar-section">
        <div class="avatar-container">
          {% if current_user.avatar %}
            <img src="{{ url_for('static', filename=current_user.avatar) }}" alt="Profile" class="profile-avatar">
          {% else %}
            <div class="avatar-default">
              <i class="fas fa-user"></i>
            </div>
          {% endif %}
        </div>
      </div>
      <div class="profile-info">
        <h1>{{ current_user.username }}</h1>
        <p class="email">{{ current_user.email }}</p>
        <p class="member-since">
          <i class="fas fa-calendar-alt"></i>
          Member since {{ current_user.created_at.strftime('%B %Y') }}
        </p>
      </div>
    </div>

    <!-- Edit Form -->
    <form method="POST" action="{{ url_for('edit_profile') }}" class="edit-form">
      {{ form.hidden_tag() }}
      
      <div class="form-grid">
        <!-- Username Field -->
        <div class="form-group">
          <label for="username">
            <i class="fas fa-user"></i> Username
          </label>
          {{ form.username(class="form-input", placeholder="Enter username") }}
          {% for error in form.username.errors %}
            <span class="error">{{ error }}</span>
          {% endfor %}
        </div>

        <!-- Email Field -->
        <div class="form-group">
          <label for="email">
            <i class="fas fa-envelope"></i> Email Address
          </label>
          {{ form.email(class="form-input", placeholder="Enter email") }}
          {% for error in form.email.errors %}
            <span class="error">{{ error }}</span>
          {% endfor %}
        </div>

        <!-- Current Password Field -->
        <div class="form-group">
          <label for="current_password">
            <i class="fas fa-lock"></i> Current Password
            <span class="hint">(required to change password)</span>
          </label>
          {{ form.current_password(class="form-input", placeholder="Enter current password") }}
          {% for error in form.current_password.errors %}
            <span class="error">{{ error }}</span>
          {% endfor %}
        </div>

        <!-- New Password Field -->
        <div class="form-group">
          <label for="new_password">
            <i class="fas fa-key"></i> New Password
            <span class="hint">(leave blank to keep current)</span>
          </label>
          {{ form.new_password(class="form-input", placeholder="Enter new password") }}
          {% for error in form.new_password.errors %}
            <span class="error">{{ error }}</span>
          {% endfor %}
        </div>

        <!-- Confirm Password Field -->
        <div class="form-group">
          <label for="confirm_password">
            <i class="fas fa-key"></i> Confirm New Password
          </label>
          {{ form.confirm_password(class="form-input", placeholder="Confirm new password") }}
          {% for error in form.confirm_password.errors %}
            <span class="error">{{ error }}</span>
          {% endfor %}
        </div>
      </div>

      <!-- Form Actions -->
      <div class="form-actions">
        <a href="{{ url_for('dashboard') }}" class="btn btn-cancel">
          <i class="fas fa-times"></i> Cancel
        </a>
        <button type="submit" class="btn btn-save">
          <i class="fas fa-save"></i> Save Changes
        </button>
      </div>
    </form>
  </div>
</div>
{% endblock %}