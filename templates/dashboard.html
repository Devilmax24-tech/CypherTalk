{% extends "base.html" %}

{% block title %}Dashboard - CypherTalk{% endblock %}

{% block content %}
<div class="dashboard-container reveal-on-scroll">
    <div class="dashboard-wrapper">
        <!-- Header Section -->
        <div class="dashboard-header-section">
            <div class="user-welcome-card">
                <div class="user-avatar">
                    <i class="fas fa-user-circle"></i>
                </div>
                <div class="user-info">
                    <h1>Welcome back, {{ user.username }}!</h1>
                    <div class="user-meta">
                        <span class="user-email">{{ user.email }}</span>
                        <span class="user-join-date">Joined {{ user.created_at.strftime('%b %Y') if user.created_at else 'Recently' }}</span>
                    </div>
                    <div class="user-status-badge">
                        {% if user.is_premium %}
                            <span class="premium-badge"><i class="fas fa-crown"></i> Premium Member</span>
                        {% else %}
                            <span class="free-badge"><i class="fas fa-user"></i> Free Member</span>
                            <span class="upgrade-link">Free Account</span>
                        {% endif %}
                    </div>
                </div>
                <div class="header-actions">
                   <a href="{{ url_for('edit_profile') }}" class="btn-action">
                    <i class="fas fa-user-edit"></i>
                    </a>
                </div>
            </div>
        </div>

        <!-- Main Dashboard Grid -->
        <div class="dashboard-main-grid">
            <!-- Left Column: Stats & Quick Actions -->
            <div class="dashboard-left-column">
                <!-- Statistics Card -->
                <div class="stats-card">
                    <div class="card-header">
                        <h3><i class="fas fa-chart-bar"></i> Your Learning Statistics</h3>
                        <span class="stats-period">Last 30 days</span>
                    </div>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-icon">
                                <i class="fas fa-file-download"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-value">{{ user_stats.downloads_total if user_stats else '0' }}</div>
                                <div class="stat-label">Total Downloads</div>
                                <div class="stat-change">
                                    <i class="fas fa-arrow-up"></i>
                                    <span>{{ user_stats.downloads_this_month if user_stats else '0' }} this month</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="stat-item">
                            <div class="stat-icon">
                                <i class="fas fa-file-alt"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-value">{{ user_stats.pyq_downloaded if user_stats else '0' }}</div>
                                <div class="stat-label">PYQs Downloaded</div>
                                <div class="stat-subtext">Previous Year Questions</div>
                            </div>
                        </div>
                        
                        <div class="stat-item">
                            <div class="stat-icon">
                                <i class="fas fa-sticky-note"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-value">{{ user_stats.notes_downloaded if user_stats else '0' }}</div>
                                <div class="stat-label">Notes Downloaded</div>
                                <div class="stat-subtext">Study Materials</div>
                            </div>
                        </div>
                        
                        <div class="stat-item">
                            <div class="stat-icon">
                                <i class="fas fa-book"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-value">{{ user_stats.semester_papers_downloaded if user_stats else '0' }}</div>
                                <div class="stat-label">Semester Papers</div>
                                <div class="stat-subtext">Exam Papers</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions Card -->
                <div class="quick-actions-card">
                    <h3><i class="fas fa-bolt"></i> Quick Actions</h3>
                    <div class="actions-grid">
                        <a href="{{ url_for('resources') }}" class="action-item">
                            <div class="action-icon">
                                <i class="fas fa-search"></i>
                            </div>
                            <div class="action-content">
                                <div class="action-title">Browse Resources</div>
                                <div class="action-desc">Find PYQs, Notes & Papers</div>
                            </div>
                            <i class="fas fa-chevron-right action-arrow"></i>
                        </a>
                        
                        <a href="{{ url_for('upload_resource') }}" class="action-item">
                            <div class="action-icon">
                                <i class="fas fa-upload"></i>
                            </div>
                            <div class="action-content">
                                <div class="action-title">Upload Resource</div>
                                <div class="action-desc">Share with community</div>
                            </div>
                            <i class="fas fa-chevron-right action-arrow"></i>
                        </a>
                      
                        <a href="{{ url_for('') }}" class="action-item">
                            <div class="action-icon">
                                <i class="fas fa-user-graduate"></i>
                            </div>
                            <div class="action-content">
                                <div class="action-title">Find Mentor</div>
                                <div class="action-desc">Connect with alumni</div>
                            </div>
                            <i class="fas fa-chevron-right action-arrow"></i>
                        </a>
                        
                        <a href="{{ url_for('bookmarks') }}" class="action-item">
                            <div class="action-icon">
                                <i class="fas fa-bookmark"></i>
                            </div>
                            <div class="action-content">
                                <div class="action-title">Bookmarks</div>
                                <div class="action-desc">Saved resources</div>
                            </div>
                            <i class="fas fa-chevron-right action-arrow"></i>
                        </a> 
                    </div>
                </div>
            </div>

            <!-- Right Column: Recent Activity & Upload -->
            <div class="dashboard-right-column">
                <!-- Recent Activity Card -->
                <div class="activity-card">
                    <div class="card-header">
                        <h3><i class="fas fa-history"></i> Recent Activity</h3>
                        <a href="{{ url_for('activity') }}" class="view-all">View All</a>
                    </div>
                    <div class="activity-list">
                        {% if recent_activities %}
                            {% for activity in recent_activities %}
                            <div class="activity-item">
                                <div class="activity-icon">
                                    {% if activity.type == 'download' %}
                                        <i class="fas fa-download"></i>
                                    {% elif activity.type == 'upload' %}
                                        <i class="fas fa-upload"></i>
                                    {% elif activity.type == 'view' %}
                                        <i class="fas fa-eye"></i>
                                    {% else %}
                                        <i class="fas fa-bell"></i>
                                    {% endif %}
                                </div>
                                <div class="activity-content">
                                    <div class="activity-title">{{ activity.title }}</div>
                                    <div class="activity-meta">
                                        <span class="activity-time">{{ activity.time }}</span>
                                        <span class="activity-type {{ activity.type }}">{{ activity.type|title }}</span>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        {% else %}
                            <div class="no-activity">
                                <i class="fas fa-inbox"></i>
                                <p>No recent activity yet</p>
                                <small>Start exploring resources!</small>
                            </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Upload Card -->
                <div class="upload-card">
                    <div class="upload-header">
                        <h3><i class="fas fa-cloud-upload-alt"></i> Share Resource</h3>
                        <p>Contribute to the community</p>
                    </div>
                    
                    <form method="POST" action="{{ url_for('upload_resource') }}" class="upload-form" enctype="multipart/form-data">
                        <div class="form-group">
                            <label for="title"><i class="fas fa-heading"></i> Resource Title</label>
                            <input type="text" id="title" name="title" placeholder="e.g., Calculus PYQ 2023" required>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="resource_type"><i class="fas fa-tag"></i> Type</label>
                                <select id="resource_type" name="resource_type" required>
                                    <option value="">Select Type</option>
                                    <option value="pyq">Previous Year Question (PYQ)</option>
                                    <option value="notes">Study Notes</option>
                                    <option value="semester">Semester Paper</option>
                                    <option value="solution">Solution Manual</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="semester"><i class="fas fa-layer-group"></i> Semester</label>
                                <select id="semester" name="semester" required>
                                    <option value="">Select Semester</option>
                                    {% for i in range(1, 9) %}
                                        <option value="{{ i }}">Semester {{ i }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="subject"><i class="fas fa-book"></i> Subject</label>
                            <input type="text" id="subject" name="subject" placeholder="e.g., Data Structures" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="branch"><i class="fas fa-theater-masks"> Branch</i></label>
                             <select id="branch_type" name="branch_type" required>
                                    <option value="">Select Branch</option>
                                    <option value="branch">CSE</option>
                                    <option value="branch">Ai/ML</option>
                                    <option value="branch">ECE</option>
                                    <option value="branch">EE</option>
                                    <option value="branch">Civil</option>
                                    <option value="branch">Mechanical</option>
                                    <option value="branch">Bio-Tech</option>
                                </select>
                        </div>

                        <div class="form-group">
                            <label for="description"><i class="fas fa-align-left"></i> Description (Optional)</label>
                            <textarea id="description" name="description" placeholder="Brief description of the resource..." rows="2"></textarea>
                        </div>
                        
                        <div class="file-upload-area">
                            <div class="upload-dropzone" id="dropzone">
                                <i class="fas fa-cloud-upload-alt"></i>
                                <p>Drag & drop files here or</p>
                                <input type="file" id="file" name="file" accept=".pdf,.doc,.docx,.jpg,.png" required>
                                <label for="file" class="browse-btn">Browse Files</label>
                                <small>Supports PDF, DOC, JPG, PNG (Max 10MB)</small>
                            </div>
                            <div class="file-preview" id="filePreview"></div>
                        </div>
                        
                        <button type="submit" class="upload-submit-btn">
                            <i class="fas fa-upload"></i> Upload Resource
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Resource Categories Section -->
        <div class="categories-section">
            <h3><i class="fas fa-folder"></i> Browse by Category</h3>
            <div class="categories-grid">
                <a href="{{ url_for('resources', type='pyq') }}" class="category-card">
                    <div class="category-icon pyq">
                        <i class="fas fa-file-contract"></i>
                    </div>
                    <div class="category-content">
                        <div class="category-title">PYQs</div>
                        <div class="category-count">{{ categories.pyq_count if categories else '0' }} resources</div>
                    </div>
                </a>
                
                <a href="{{ url_for('resources', type='notes') }}" class="category-card">
                    <div class="category-icon notes">
                        <i class="fas fa-sticky-note"></i>
                    </div>
                    <div class="category-content">
                        <div class="category-title">Notes</div>
                        <div class="category-count">{{ categories.notes_count if categories else '0' }} resources</div>
                    </div>
                </a>
                
                <a href="{{ url_for('resources', type='semester') }}" class="category-card">
                    <div class="category-icon semester">
                        <i class="fas fa-file-signature"></i>
                    </div>
                    <div class="category-content">
                        <div class="category-title">Semester Papers</div>
                        <div class="category-count">{{ categories.semester_count if categories else '0' }} resources</div>
                    </div>
                </a>
                
                <a href="{{ url_for('resources', type='solution') }}" class="category-card">
                    <div class="category-icon solution">
                        <i class="fas fa-file-check"></i>
                    </div>
                    <div class="category-content">
                        <div class="category-title">Solutions</div>
                        <div class="category-count">{{ categories.solution_count if categories else '0' }} resources</div>
                    </div>
                </a>
            </div>
        </div>
    </div>
</div>

<!-- JavaScript for file upload preview -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const fileInput = document.getElementById('file');
    const filePreview = document.getElementById('filePreview');
    const dropzone = document.getElementById('dropzone');
    
    // File selection handler
    fileInput.addEventListener('change', function(e) {
        handleFiles(e.target.files);
    });
    
    // Drag and drop handlers
    dropzone.addEventListener('dragover', function(e) {
        e.preventDefault();
        dropzone.classList.add('dragover');
    });
    
    dropzone.addEventListener('dragleave', function(e) {
        e.preventDefault();
        dropzone.classList.remove('dragover');
    });
    
    dropzone.addEventListener('drop', function(e) {
        e.preventDefault();
        dropzone.classList.remove('dragover');
        handleFiles(e.dataTransfer.files);
    });
    
    function handleFiles(files) {
        filePreview.innerHTML = '';
        
        if (files.length > 0) {
            const file = files[0];
            const fileSize = (file.size / (1024*1024)).toFixed(2);
            
            if (fileSize > 10) {
                alert('File size exceeds 10MB limit');
                fileInput.value = '';
                return;
            }
            
            const preview = document.createElement('div');
            preview.className = 'file-item';
            preview.innerHTML = `
                <i class="fas fa-file-pdf"></i>
                <div class="file-info">
                    <div class="file-name">${file.name}</div>
                    <div class="file-size">${fileSize} MB</div>
                </div>
                <button type="button" class="remove-file" onclick="removeFile()">
                    <i class="fas fa-times"></i>
                </button>
            `;
            filePreview.appendChild(preview);
        }
    }
    
    window.removeFile = function() {
        fileInput.value = '';
        filePreview.innerHTML = '';
    }
});
</script>
{% endblock %}